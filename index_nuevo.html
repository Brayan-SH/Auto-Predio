<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auto Predio</title>
    <!-- Bootstrap 5.3 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href=style.css />">
  </head>
  <body>
    <!-- Navbar Sticky -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
      <div class="container">
        <a class="navbar-brand text-primary" href="#">
          游뚱 Auto Predio
        </a>
        
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#inicio">Inicio</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#vehiculos">Cat치logo</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#usuarios">Usuarios</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#contacto">Contacto</a>
            </li>
          </ul>
          
          <form class="d-flex">
            <button class="btn btn-outline-primary" type="button" onclick="buscarGlobal()">
              Buscar
            </button>
          </form>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section id="inicio" class="hero-section">
      <div class="container">
        <div class="row justify-content-center text-center">
          <div class="col-lg-8">
            <h1 class="display-4 fw-bold mb-3">
              Bienvenido a Auto Predio
            </h1>
            <p class="lead mb-4">
              Tu plataforma integral para la gesti칩n de veh칤culos, usuarios y concesionarios
            </p>
            <div class="d-flex justify-content-center gap-3">
              <button class="btn btn-light btn-lg" onclick="scrollToSection('vehiculos')">
                Ver Cat치logo
              </button>
              <button class="btn btn-outline-light btn-lg" onclick="scrollToSection('usuarios')">
                Gestionar Usuarios
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Contenido Principal -->
    <div class="container my-5">
      
      <!-- Secci칩n de Estad칤sticas R치pidas -->
      <div class="row mb-5">
        <div class="col-md-4">
          <div class="card text-center h-100">
            <div class="card-body">
              <i class="bi bi-car-front fs-1 text-primary"></i>
              <h5 class="card-title mt-3">Veh칤culos</h5>
              <p class="card-text text-muted">Gestiona tu inventario completo</p>
              <button class="btn btn-primary" onclick="cargarVehiculos()">Ver Todos</button>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center h-100">
            <div class="card-body">
              <i class="bi bi-people fs-1 text-success"></i>
              <h5 class="card-title mt-3">Usuarios</h5>
              <p class="card-text text-muted">Administra clientes y personal</p>
              <button class="btn btn-success" onclick="cargarUsuarios()">Ver Todos</button>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center h-100">
            <div class="card-body">
              <i class="bi bi-graph-up fs-1 text-warning"></i>
              <h5 class="card-title mt-3">Reportes</h5>
              <p class="card-text text-muted">An치lisis y estad칤sticas</p>
              <button class="btn btn-warning" onclick="mostrarReportes()">Ver Reportes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Secci칩n de Veh칤culos -->
      <section id="vehiculos" class="mb-5">
        <div class="row">
          <div class="col-12">
            <div class="card vehiculo-card">
              <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">游뚱 Veh칤culos Disponibles</h4>
                <div class="d-flex gap-2">
                  <button class="btn btn-light btn-sm" onclick="cargarVehiculos()">
                    Cargar
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div id="vehiculos-container">
                  <!-- Los veh칤culos se cargar치n aqu칤 -->
                  <div class="text-center py-4">
                    <div class="spinner-border text-success" role="status">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2 text-muted">Cargando veh칤culos...</p>
                  </div>
                </div>
                <!-- Controles de paginaci칩n -->
                <div id="pagination-vehiculos" class="mt-3">
                  <!-- Paginaci칩n se cargar치 aqu칤 -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Secci칩n de Usuarios -->
      <section id="usuarios" class="mb-5">
        <div class="row">
          <div class="col-12">
            <div class="card usuario-card">
              <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">游논 Usuarios Registrados</h4>
                <button class="btn btn-light btn-sm" onclick="cargarUsuarios()">
                  Actualizar
                </button>
              </div>
              <div class="card-body">
                <div id="usuarios-container">
                  <!-- Los usuarios se cargar치n aqu칤 -->
                  <div class="text-center py-4">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-2 text-muted">Cargando usuarios...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h5>Auto Predio</h5>
            <p class="text-muted">Sistema de gesti칩n de veh칤culos y usuarios</p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="text-muted">춸 2025 Auto Predio. Todos los derechos reservados.</p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap 5.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      // Variables globales para paginaci칩n
      let currentPage = 1;
      let currentSearch = '';

      // Funci칩n para scroll suave a secciones
      function scrollToSection(sectionId) {
        document.getElementById(sectionId).scrollIntoView({ 
          behavior: 'smooth',
          block: 'start'
        });
      }

      // Funci칩n para b칰squeda global desde navbar
      function buscarGlobal() {
        const search = document.getElementById('navbar-search').value;
        document.getElementById('search-vehiculos').value = search;
        scrollToSection('vehiculos');
        setTimeout(() => cargarVehiculos(), 500);
      }

      // Funci칩n para cargar veh칤culos con paginaci칩n
      function cargarVehiculos(page = 1) {
        const container = document.getElementById("vehiculos-container");
        const paginationContainer = document.getElementById("pagination-vehiculos");
        const searchInput = document.getElementById("search-vehiculos");
        
        currentPage = page;
        currentSearch = searchInput ? searchInput.value : '';
        
        container.innerHTML = `
          <div class="text-center py-4">
            <div class="spinner-border text-success" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2 text-muted">Buscando veh칤culos...</p>
          </div>
        `;
        paginationContainer.innerHTML = '';
        
        // Construir URL con par치metros
        let url = `http://localhost:5000/api/vehiculos?page=${page}&per_page=6`;
        if (currentSearch) {
          url += `&search=${encodeURIComponent(currentSearch)}`;
        }
        
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            let html = "";
            if (data.vehiculos.length === 0) {
              html = `
                <div class="alert alert-info text-center">
                  <i class="bi bi-info-circle fs-4"></i>
                  <h6 class="mt-2">No hay veh칤culos encontrados</h6>
                  <p class="mb-0">Intenta con otros t칠rminos de b칰squeda</p>
                </div>
              `;
            } else {
              html = '<div class="row">';
              data.vehiculos.forEach((vehiculo) => {
                html += `
                  <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100 vehiculo-item">
                      <div class="card-body">
                        <h5 class="card-title text-success">${vehiculo.marca} ${vehiculo.modelo}</h5>
                        <div class="row text-sm">
                          <div class="col-6">
                            <small class="text-muted">A침o:</small><br>
                            <strong>${vehiculo.anio_fabricacion}</strong>
                          </div>
                          <div class="col-6">
                            <small class="text-muted">Color:</small><br>
                            <strong>${vehiculo.color}</strong>
                          </div>
                        </div>
                        <hr>
                        <div class="row">
                          <div class="col-6">
                            <small class="text-muted">Precio:</small><br>
                            <strong class="text-success fs-5">${vehiculo.precio}</strong>
                          </div>
                          <div class="col-6">
                            <small class="text-muted">Kilometraje:</small><br>
                            <strong>${vehiculo.kilometraje} km</strong>
                          </div>
                        </div>
                        <div class="mt-3 d-flex justify-content-between align-items-center">
                          <span class="badge bg-info">${vehiculo.condicion}</span>
                          <button class="btn btn-outline-primary btn-sm" onclick="verDetalle('${vehiculo.vin}')">
                            Ver Detalle
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                `;
              });
              html += '</div>';
            }
            container.innerHTML = html;
            
            // Crear controles de paginaci칩n
            if (data.pagination.total_pages > 1) {
              createPagination(data.pagination);
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            container.innerHTML = `
              <div class="alert alert-danger text-center">
                <i class="bi bi-exclamation-triangle fs-4"></i>
                <h6 class="mt-2">Error al cargar veh칤culos</h6>
                <p class="mb-0">Verifica la conexi칩n con el servidor</p>
              </div>
            `;
          });
      }

      // Funci칩n para crear controles de paginaci칩n
      function createPagination(pagination) {
        const container = document.getElementById('pagination-vehiculos');
        let html = '<nav><ul class="pagination justify-content-center">';
        
        // Bot칩n anterior
        if (pagination.has_prev) {
          html += `<li class="page-item"><a class="page-link" href="#" onclick="cargarVehiculos(${pagination.page - 1})">Anterior</a></li>`;
        } else {
          html += '<li class="page-item disabled"><span class="page-link">Anterior</span></li>';
        }
        
        // N칰meros de p치gina (m치ximo 5 p치ginas visibles)
        let startPage = Math.max(1, pagination.page - 2);
        let endPage = Math.min(pagination.total_pages, pagination.page + 2);
        
        for (let i = startPage; i <= endPage; i++) {
          if (i === pagination.page) {
            html += `<li class="page-item active"><span class="page-link">${i}</span></li>`;
          } else {
            html += `<li class="page-item"><a class="page-link" href="#" onclick="cargarVehiculos(${i})">${i}</a></li>`;
          }
        }
        
        // Bot칩n siguiente
        if (pagination.has_next) {
          html += `<li class="page-item"><a class="page-link" href="#" onclick="cargarVehiculos(${pagination.page + 1})">Siguiente</a></li>`;
        } else {
          html += '<li class="page-item disabled"><span class="page-link">Siguiente</span></li>';
        }
        
        html += '</ul></nav>';
        html += `<div class="text-center mt-2">
          <small class="text-muted">
            Mostrando hasta ${pagination.per_page} de ${pagination.total} veh칤culos 
            (P치gina ${pagination.page} de ${pagination.total_pages})
          </small>
        </div>`;
        
        container.innerHTML = html;
      }

      // Funci칩n para ver detalle de un veh칤culo
      function verDetalle(vin) {
        fetch(`http://localhost:5000/api/vehiculos/${vin}`)
          .then(response => response.json())
          .then(vehiculo => {
            if (vehiculo.error) {
              alert('Veh칤culo no encontrado');
              return;
            }
            
            // Crear modal con detalles mejorado
            const modalHtml = `
              <div class="modal fade" id="detalleModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                      <h5 class="modal-title">
                        游뚱 ${vehiculo.marca} ${vehiculo.modelo} ${vehiculo.anio_fabricacion}
                      </h5>
                      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                      <div class="row">
                        <div class="col-md-6">
                          <h6 class="text-primary">Informaci칩n General</h6>
                          <table class="table table-sm">
                            <tr><td><strong>VIN:</strong></td><td>${vehiculo.vin}</td></tr>
                            <tr><td><strong>Marca:</strong></td><td>${vehiculo.marca}</td></tr>
                            <tr><td><strong>Modelo:</strong></td><td>${vehiculo.modelo}</td></tr>
                            <tr><td><strong>A침o:</strong></td><td>${vehiculo.anio_fabricacion}</td></tr>
                            <tr><td><strong>Color:</strong></td><td>${vehiculo.color}</td></tr>
                          </table>
                        </div>
                        <div class="col-md-6">
                          <h6 class="text-success">Detalles T칠cnicos</h6>
                          <table class="table table-sm">
                            <tr><td><strong>Kilometraje:</strong></td><td>${vehiculo.kilometraje} km</td></tr>
                            <tr><td><strong>Transmisi칩n:</strong></td><td>${vehiculo.transmision}</td></tr>
                            <tr><td><strong>Combustible:</strong></td><td>${vehiculo.tipo_combustible}</td></tr>
                            <tr><td><strong>Condici칩n:</strong></td><td><span class="badge bg-info">${vehiculo.condicion}</span></td></tr>
                            <tr><td><strong>Precio:</strong></td><td><span class="text-success fs-5 fw-bold">${vehiculo.precio}</span></td></tr>
                          </table>
                        </div>
                      </div>
                      <hr>
                      <div class="row">
                        <div class="col-12">
                          <h6 class="text-warning">Informaci칩n de Contacto</h6>
                          <p><strong>Vendedor:</strong> ${vehiculo.predio_vendedor}</p>
                          <p><strong>Contacto:</strong> ${vehiculo.contacto}</p>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                      <button type="button" class="btn btn-primary">Contactar Vendedor</button>
                    </div>
                  </div>
                </div>
              </div>
            `;
            
            // Agregar modal al DOM y mostrarlo
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('detalleModal'));
            modal.show();
            
            // Remover modal cuando se cierre
            document.getElementById('detalleModal').addEventListener('hidden.bs.modal', function() {
              this.remove();
            });
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error al cargar detalles del veh칤culo');
          });
      }

      // Funci칩n para cargar usuarios
      function cargarUsuarios() {
        const container = document.getElementById('usuarios-container');
        container.innerHTML = `
          <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2 text-muted">Cargando usuarios...</p>
          </div>
        `;
        
        fetch("http://localhost:5000/api/usuarios")
          .then(response => response.json())
          .then(data => {
            let html = '';
            if (data.length === 0) {
              html = `
                <div class="alert alert-info text-center">
                  <i class="bi bi-info-circle fs-4"></i>
                  <h6 class="mt-2">No hay usuarios registrados</h6>
                </div>
              `;
            } else {
              html = '<div class="row">';
              data.forEach(usuario => {
                html += `
                  <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card h-100">
                      <div class="card-body">
                        <h6 class="card-title text-primary">${usuario.nombres} ${usuario.apellidos}</h6>
                        <div class="text-sm">
                          <p class="mb-1"><small class="text-muted">DPI:</small> ${usuario.dpi}</p>
                          <p class="mb-1"><small class="text-muted">Email:</small> ${usuario.correo_electronico}</p>
                          <p class="mb-1"><small class="text-muted">Tel칠fono:</small> ${usuario.telefono}</p>
                          <span class="badge bg-secondary">${usuario.rol}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                `;
              });
              html += '</div>';
            }
            container.innerHTML = html;
          })
          .catch(error => {
            console.error('Error:', error);
            container.innerHTML = `
              <div class="alert alert-danger text-center">
                <i class="bi bi-exclamation-triangle fs-4"></i>
                <h6 class="mt-2">Error al cargar usuarios</h6>
              </div>
            `;
          });
      }

      // Funci칩n placeholder para reportes
      function mostrarReportes() {
        alert('Funci칩n de reportes en desarrollo');
      }

      // Inicializaci칩n cuando carga la p치gina
      document.addEventListener('DOMContentLoaded', function() {
        // Cargar usuarios autom치ticamente
        cargarUsuarios();
        
        // Configurar smooth scroll para enlaces de navegaci칩n
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
          anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
              target.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }
          });
        });

        // Activar navbar en scroll
        window.addEventListener('scroll', function() {
          const navbar = document.querySelector('.navbar');
          if (window.scrollY > 100) {
            navbar.classList.add('shadow');
          } else {
            navbar.classList.remove('shadow');
          }
        });
      });
    </script>
  </body>
</html>